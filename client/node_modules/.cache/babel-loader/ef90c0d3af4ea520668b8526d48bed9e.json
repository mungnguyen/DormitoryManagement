{"ast":null,"code":"/*!\n* Tobi - CookieJar\n* Copyright(c) 2010 LearnBoost <dev@learnboost.com>\n* MIT Licensed\n*/\n\n/**\n* Module dependencies.\n*/\nvar url = require('url');\n/**\n* Initialize a new `CookieJar`.\n*\n* @api private\n*/\n\n\nvar CookieJar = exports = module.exports = function CookieJar() {\n  this.cookies = [];\n};\n/**\n* Add the given `cookie` to the jar.\n*\n* @param {Cookie} cookie\n* @api private\n*/\n\n\nCookieJar.prototype.add = function (cookie) {\n  this.cookies = this.cookies.filter(function (c) {\n    // Avoid duplication (same path, same name)\n    return !(c.name == cookie.name && c.path == cookie.path);\n  });\n  this.cookies.push(cookie);\n};\n/**\n* Get cookies for the given `req`.\n*\n* @param {IncomingRequest} req\n* @return {Array}\n* @api private\n*/\n\n\nCookieJar.prototype.get = function (req) {\n  var path = url.parse(req.url).pathname,\n      now = new Date(),\n      specificity = {};\n  return this.cookies.filter(function (cookie) {\n    if (0 == path.indexOf(cookie.path) && now < cookie.expires && cookie.path.length > (specificity[cookie.name] || 0)) return specificity[cookie.name] = cookie.path.length;\n  });\n};\n/**\n* Return Cookie string for the given `req`.\n*\n* @param {IncomingRequest} req\n* @return {String}\n* @api private\n*/\n\n\nCookieJar.prototype.cookieString = function (req) {\n  var cookies = this.get(req);\n\n  if (cookies.length) {\n    return cookies.map(function (cookie) {\n      return cookie.name + '=' + cookie.value;\n    }).join('; ');\n  }\n};","map":null,"metadata":{},"sourceType":"script"}